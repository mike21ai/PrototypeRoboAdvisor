<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyGoal - AI Financial Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .screen { display: none; }
        .active { display: block; }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 50; }
        @keyframes fill-progress { from { width: 0%; } }
        .progress-bar-fill { animation: fill-progress 1.5s ease-out forwards; }
        .bottom-nav-item.active svg { color: #2563eb; }
        .bottom-nav-item.active p { color: #2563eb; font-weight: 600; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="app" class="max-w-md mx-auto min-h-screen bg-white shadow-lg pb-20">

        <!-- ===== SCREEN 1: SPLASH SCREEN ===== -->
        <div id="splashScreen" class="screen active flex flex-col items-center justify-center min-h-screen p-8 text-center bg-blue-600 text-white">
            <i data-lucide="target" class="w-24 h-24 mb-6"></i>
            <h1 class="text-4xl font-bold">MyGoal</h1>
            <p class="text-lg mt-2 opacity-90">Wujudkan Impian Finansialmu dengan Cerdas</p>
            <button onclick="showScreen('profilingScreen')" class="mt-12 bg-white text-blue-600 font-bold py-3 px-8 rounded-full shadow-lg hover:bg-gray-100 transition-transform transform hover:scale-105">Mulai Sekarang</button>
        </div>

        <!-- ===== SCREEN 2: PROFILING QUIZ ===== -->
        <div id="profilingScreen" class="screen p-6">
            <h2 class="text-2xl font-bold mb-1">Kenali Profil Risikomu</h2>
            <p class="text-gray-600 mb-6">Jawab beberapa pertanyaan untuk personalisasi investasimu.</p>
            <form id="quizForm" class="space-y-6">
                 <div>
                    <label class="font-semibold block mb-2">1. Jika investasimu turun 20% dalam sebulan, apa reaksimu?</label>
                    <div class="space-y-2">
                        <label class="flex items-center p-3 border rounded-lg hover:bg-blue-50"><input type="radio" name="q1" value="1" class="mr-3" required> Jual semua, saya tidak bisa rugi.</label>
                        <label class="flex items-center p-3 border rounded-lg hover:bg-blue-50"><input type="radio" name="q1" value="2" class="mr-3"> Cemas, tapi akan saya tahan.</label>
                        <label class="flex items-center p-3 border rounded-lg hover:bg-blue-50"><input type="radio" name="q1" value="3" class="mr-3"> Biasa saja, ini kesempatan untuk beli lagi.</label>
                    </div>
                </div>
                <div>
                    <label class="font-semibold block mb-2">2. Apa tujuan utamamu berinvestasi?</label>
                    <div class="space-y-2">
                        <label class="flex items-center p-3 border rounded-lg hover:bg-blue-50"><input type="radio" name="q2" value="1" class="mr-3" required> Mengamankan nilai uang dari inflasi.</label>
                        <label class="flex items-center p-3 border rounded-lg hover:bg-blue-50"><input type="radio" name="q2" value="2" class="mr-3"> Pertumbuhan seimbang.</label>
                        <label class="flex items-center p-3 border rounded-lg hover:bg-blue-50"><input type="radio" name="q2" value="3" class="mr-3"> Keuntungan maksimal.</label>
                    </div>
                </div>
                <div>
                    <label class="font-semibold block mb-2">3. Pengalamanmu berinvestasi?</label>
                    <div class="space-y-2">
                        <label class="flex items-center p-3 border rounded-lg hover:bg-blue-50"><input type="radio" name="q3" value="1" class="mr-3" required> Baru mulai.</label>
                        <label class="flex items-center p-3 border rounded-lg hover:bg-blue-50"><input type="radio" name="q3" value="2" class="mr-3"> Kurang dari 3 tahun.</label>
                        <label class="flex items-center p-3 border rounded-lg hover:bg-blue-50"><input type="radio" name="q3" value="3" class="mr-3"> Lebih dari 3 tahun.</label>
                    </div>
                </div>
                <button type="button" onclick="calculateProfile()" class="w-full mt-8 bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow hover:bg-blue-700">Lanjut ke Cek Keuangan</button>
            </form>
        </div>
        
        <!-- ===== SCREEN 3: FINANCIAL HEALTH CHECK ===== -->
        <div id="financialCheckScreen" class="screen p-6">
            <h2 class="text-2xl font-bold mb-1">Cek Kondisi Keuanganmu</h2>
            <p class="text-gray-600 mb-6">Data ini membantu kami memberikan rekomendasi yang realistis. (Estimasi saja)</p>
            <form id="financialForm" class="space-y-4">
                <div><label for="monthlyIncome" class="font-semibold block mb-1">Pendapatan Per Bulan (Rp)</label><input type="number" id="monthlyIncome" class="w-full border rounded-lg p-3" placeholder="Contoh: 10000000" required></div>
                <div><label for="monthlyExpenses" class="font-semibold block mb-1">Pengeluaran Rutin Per Bulan (Rp)</label><input type="number" id="monthlyExpenses" class="w-full border rounded-lg p-3" placeholder="Contoh: 6000000" required></div>
                <button type="button" onclick="calculateFinancialHealth()" class="w-full mt-8 bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow hover:bg-blue-700">Selesai & Lihat Dashboard</button>
            </form>
        </div>

        <!-- ===== SCREEN 4: DASHBOARD ===== -->
        <div id="dashboardScreen" class="screen">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h1 class="text-2xl font-bold">Halo, Investor!</h1>
                        <p class="text-gray-600">Profil: <span id="userProfile" class="font-semibold text-blue-600"></span></p>
                    </div>
                    <div class="relative">
                        <i data-lucide="bell" class="text-gray-500 cursor-pointer" onclick="changeTab('roadmapScreen')"></i>
                        <div id="notificationBadge" class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border-2 border-white hidden"></div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h3 class="font-semibold text-blue-800 text-sm">Total Aset</h3>
                        <p id="totalAssets" class="text-2xl font-bold text-blue-900 mt-1">Rp 0</p>
                    </div>
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <h3 class="font-semibold text-green-800 text-sm">Kemampuan Investasi</h3>
                        <p id="investmentCapacity" class="text-2xl font-bold text-green-900 mt-1">Rp 0 /bln</p>
                    </div>
                </div>
                <div id="achievementsSection" class="mb-6">
                    <h3 class="text-xl font-bold mb-4">Pencapaianmu</h3>
                    <div id="achievementsContainer" class="flex space-x-4 overflow-x-auto pb-2"></div>
                </div>
                <h3 class="text-xl font-bold mb-4">Tujuan Finansialmu</h3>
                <div id="goalsContainer" class="space-y-4"></div>
            </div>
        </div>

        <!-- ===== SCREEN 5: ROADMAP AKSI (BARU) ===== -->
        <div id="roadmapScreen" class="screen p-6">
            <h2 class="text-2xl font-bold mb-1">Rencana Aksimu</h2>
            <p class="text-gray-600 mb-6">Checklist bulanan agar kamu tetap di jalur yang benar.</p>
            <div id="roadmapContainer" class="space-y-4">
                <!-- Checklist items will be injected here -->
            </div>
        </div>

        <!-- ===== SCREEN 6: GOAL CREATION ===== -->
        <div id="goalCreationScreen" class="screen p-6">
            <button onclick="showScreen('dashboardScreen')" class="text-gray-600 hover:text-gray-900 mb-4"><i data-lucide="arrow-left" class="inline-block"></i> Kembali</button>
            <h2 class="text-2xl font-bold mb-1">Pilih Jenis Mimpimu</h2>
            <p class="text-gray-600 mb-6">Kami akan siapkan template untukmu.</p>
            <div id="goalTemplatesContainer" class="grid grid-cols-3 gap-4 text-center"></div>
        </div>
        
        <!-- ===== SCREEN 7: GOAL DETAIL ===== -->
        <div id="goalDetailScreen" class="screen p-6">
            <button onclick="showScreen('goalCreationScreen')" class="text-gray-600 hover:text-gray-900 mb-4"><i data-lucide="arrow-left" class="inline-block"></i> Kembali</button>
            <h2 class="text-2xl font-bold mb-1" id="goalDetailTitle">Detail Tujuanmu</h2>
            <p class="text-gray-600 mb-6">Isi detailnya untuk membuat rencana.</p>
            <form id="goalDetailForm" class="space-y-4">
                <input type="hidden" id="goalIcon">
                <div><label for="goalName" class="font-semibold block mb-1">Nama Tujuan</label><input type="text" id="goalName" class="w-full border rounded-lg p-3" required></div>
                <div><label for="goalAmount" class="font-semibold block mb-1">Target Dana (Rp)</label><input type="number" id="goalAmount" class="w-full border rounded-lg p-3" placeholder="Contoh: 300000000" required></div>
                <div><label for="goalYears" class="font-semibold block mb-1">Jangka Waktu (Tahun)</label><input type="number" id="goalYears" class="w-full border rounded-lg p-3" placeholder="Contoh: 5" required></div>
                <button type="button" onclick="generatePlan()" class="w-full mt-8 bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow hover:bg-blue-700">Buat Rencana Investasi</button>
            </form>
        </div>

        <!-- ===== SCREEN 8: INVESTMENT PLAN ===== -->
        <div id="planScreen" class="screen p-6">
            <button onclick="addGoalAndReturnToDashboard()" class="text-gray-600 hover:text-gray-900 mb-4"><i data-lucide="arrow-left" class="inline-block"></i> Kembali</button>
            <h2 class="text-2xl font-bold mb-1">Rencana Investasimu</h2>
            <p class="text-gray-600 mb-6">Rekomendasi cerdas untuk tujuan <strong id="planGoalName" class="capitalize text-blue-600"></strong>.</p>
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center mb-6">
                <p class="text-blue-800">Kamu perlu berinvestasi:</p>
                <p class="text-3xl font-bold text-blue-900 my-2" id="monthlyInvestment">Rp 0 / bulan</p>
                <p class="text-sm text-gray-600">Untuk mencapai <strong id="planGoalAmount"></strong> dalam <strong id="planGoalYears"></strong> tahun.</p>
            </div>
            <div id="capacityFeedback" class="mb-6 p-3 rounded-lg text-sm text-center"></div>
            <div class="mb-6">
                <h3 class="text-xl font-bold mb-2 flex items-center">Rekomendasi Alokasi Aset <i data-lucide="info" class="w-4 h-4 ml-2 text-gray-400 cursor-pointer" onclick="showEducationModal(true)"></i></h3>
                <p class="text-gray-600 mb-4 text-sm">Berdasarkan profil (<span id="planProfile" class="font-semibold"></span>) dan jangka waktu.</p>
                <div class="max-w-xs mx-auto"><canvas id="portfolioChart"></canvas></div>
                <div id="portfolioLegend" class="mt-4 space-y-2"></div>
            </div>
            <div class="border-t pt-6 mb-6">
                <h3 class="text-xl font-bold mb-2">Simulasi "What-If"</h3>
                <p class="text-gray-600 mb-4 text-sm">Lihat dampak perubahan setoran bulanan.</p>
                <div>
                    <label for="simulationSlider" class="flex justify-between items-center font-semibold mb-1"><span>Setoran Bulanan</span><span id="simulationValue" class="text-blue-600"></span></label>
                    <input type="range" id="simulationSlider" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    <p id="simulationResult" class="text-center mt-3 font-semibold text-green-700"></p>
                </div>
            </div>
            <div class="border-t pt-6 mb-6">
                <h3 class="text-xl font-bold mb-4">Proyeksi Hasil Investasimu</h3>
                <div><canvas id="projectionChart"></canvas></div>
            </div>
            <button onclick="addGoalAndReturnToDashboard()" class="w-full mt-8 bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow hover:bg-green-700">Simpan & Mulai Investasi</button>
        </div>
        
        <!-- MODAL & BOTTOM NAV -->
        <div id="educationModal" class="modal-overlay hidden" onclick="showEducationModal(false)">
            <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-sm w-full" onclick="event.stopPropagation()">
                <h3 class="text-lg font-bold mb-2">Mengapa Alokasinya Seperti Ini?</h3>
                <p class="text-sm text-gray-600">Alokasi aset disesuaikan dengan <strong>profil risiko</strong> dan <strong>jangka waktu</strong> tujuanmu.</p>
                <ul class="text-sm text-gray-600 list-disc list-inside mt-2 space-y-1">
                    <li><strong>Jangka Panjang & Agresif:</strong> Porsi saham lebih besar untuk potensi imbal hasil maksimal.</li>
                    <li><strong>Jangka Pendek & Konservatif:</strong> Porsi pasar uang dan obligasi lebih besar untuk menjaga stabilitas.</li>
                </ul>
                <button onclick="showEducationModal(false)" class="w-full mt-4 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg">Mengerti</button>
            </div>
        </div>

        <footer id="bottomNav" class="fixed bottom-0 left-1/2 -translate-x-1/2 max-w-md w-full bg-white border-t grid grid-cols-3 items-center z-20 hidden">
            <div id="nav-dashboardScreen" onclick="changeTab('dashboardScreen')" class="bottom-nav-item flex flex-col items-center justify-center p-2 cursor-pointer text-gray-500">
                <i data-lucide="layout-dashboard" class="w-6 h-6"></i><p class="text-xs">Dashboard</p>
            </div>
            <div class="flex justify-center">
                <button onclick="showScreen('goalCreationScreen')" class="w-14 h-14 bg-blue-600 text-white rounded-full flex items-center justify-center -mt-6 shadow-lg"><i data-lucide="plus" class="w-8 h-8"></i></button>
            </div>
            <div id="nav-roadmapScreen" onclick="changeTab('roadmapScreen')" class="bottom-nav-item flex flex-col items-center justify-center p-2 cursor-pointer text-gray-500">
                <i data-lucide="check-square" class="w-6 h-6"></i><p class="text-xs">Rencana Aksi</p>
            </div>
        </footer>
    </div>

    <script>
        // --- State Management ---
        const appState = {
            userProfile: null, financialProfile: null,
            goals: [{ name: "Membeli Rumah Pertama", target: 300000000, current: 15750000, years: 7, icon: 'home' }],
            achievements: [], activePlan: {},
            roadmap: { monthlyDepositDue: true }, depositStreak: 0
        };
        let portfolioChartInstance, projectionChartInstance;

        // --- Navigation & Modals ---
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            window.scrollTo(0, 0);
        }
        function changeTab(screenId) {
            showScreen(screenId);
            document.querySelectorAll('.bottom-nav-item').forEach(nav => nav.classList.remove('active'));
            document.getElementById(`nav-${screenId}`).classList.add('active');
        }
        function showEducationModal(show) { document.getElementById('educationModal').classList.toggle('hidden', !show); }

        // --- Logic ---
        function calculateProfile() {
            const form = document.getElementById('quizForm');
            if (!form.checkValidity()) { alert('Mohon jawab semua pertanyaan.'); return; }
            const score = Array.from(new FormData(form).values()).reduce((sum, val) => sum + parseInt(val), 0);
            if (score <= 4) appState.userProfile = 'Konservatif';
            else if (score <= 7) appState.userProfile = 'Moderat';
            else appState.userProfile = 'Agresif';
            showScreen('financialCheckScreen');
        }

        function calculateFinancialHealth() {
            const form = document.getElementById('financialForm');
            if (!form.checkValidity()) { alert('Mohon isi semua field.'); return; }
            const income = parseFloat(document.getElementById('monthlyIncome').value);
            const expenses = parseFloat(document.getElementById('monthlyExpenses').value);
            appState.financialProfile = { income, expenses, capacity: income - expenses };
            document.getElementById('bottomNav').classList.remove('hidden');
            changeTab('dashboardScreen');
            updateDashboard();
            renderRoadmap();
        }
        
        function selectGoalTemplate(name, icon) {
            document.getElementById('goalDetailTitle').textContent = `Detail Mimpimu: ${name}`;
            document.getElementById('goalName').value = name;
            document.getElementById('goalIcon').value = icon;
            document.getElementById('goalAmount').value = '';
            document.getElementById('goalYears').value = '';
            showScreen('goalDetailScreen');
        }

        function generatePlan() {
            const form = document.getElementById('goalDetailForm');
            if(!form.checkValidity()) { alert('Mohon isi semua field.'); return; }
            const goalName = document.getElementById('goalName').value;
            const goalAmount = parseFloat(document.getElementById('goalAmount').value);
            const goalYears = parseInt(document.getElementById('goalYears').value);
            const goalIcon = document.getElementById('goalIcon').value;

            const annualReturnRates = { 'Konservatif': 0.05, 'Moderat': 0.08, 'Agresif': 0.12 };
            const annualReturnRate = annualReturnRates[appState.userProfile] || 0.08;
            const r = annualReturnRate / 12;
            const n = goalYears * 12;
            const monthlyInvestment = (goalAmount * r) / (Math.pow(1 + r, n) - 1);
            
            Object.assign(appState.activePlan, { name: goalName, target: goalAmount, years: goalYears, icon: goalIcon, monthly: Math.round(monthlyInvestment) });

            let portfolio = {};
            if (appState.userProfile === 'Konservatif') portfolio = { 'Pasar Uang': 20, 'Obligasi': 60, 'Saham Domestik': 15, 'Saham Internasional': 5 };
            else if (appState.userProfile === 'Moderat') portfolio = { 'Pasar Uang': 10, 'Obligasi': 40, 'Saham Domestik': 35, 'Saham Internasional': 15 };
            else portfolio = { 'Pasar Uang': 5, 'Obligasi': 20, 'Saham Domestik': 50, 'Saham Internasional': 25 };
            appState.activePlan.portfolio = portfolio;
            
            document.getElementById('bottomNav').classList.add('hidden');
            renderPlanScreen();
            showScreen('planScreen');
        }
        
        function completeMonthlyDeposit() {
            appState.roadmap.monthlyDepositDue = false;
            appState.depositStreak++;
            checkForAchievements();
            renderRoadmap();
            updateDashboard();
        }

        function addGoalAndReturnToDashboard() {
            appState.goals.push({ ...appState.activePlan, current: 0 });
            checkForAchievements();
            document.getElementById('bottomNav').classList.remove('hidden');
            changeTab('dashboardScreen');
            updateDashboard();
        }
        
        function checkForAchievements() {
            if (appState.goals.length > 1 && !appState.achievements.find(a => a.id === 'first_goal')) {
                appState.achievements.push({ id: 'first_goal', name: 'Langkah Pertama', icon: 'flag' });
            }
            if (appState.depositStreak === 1 && !appState.achievements.find(a => a.id === 'streak_1')) {
                appState.achievements.push({ id: 'streak_1', name: 'Konsisten!', icon: 'flame' });
            }
        }

        // --- Rendering ---
        function formatCurrency(amount) { return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(amount); }
        function getTerm(years) {
            if (years <= 3) return `<div class="bg-yellow-100 text-yellow-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">Pendek</div>`;
            if (years <= 10) return `<div class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">Menengah</div>`;
            return `<div class="bg-green-100 text-green-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">Panjang</div>`;
        }
        
        function renderPlanScreen() { /* Same logic as before */ 
             const plan = appState.activePlan;
            document.getElementById('planGoalName').textContent = plan.name;
            document.getElementById('planGoalAmount').textContent = formatCurrency(plan.target);
            document.getElementById('planGoalYears').textContent = plan.years;
            document.getElementById('monthlyInvestment').textContent = `${formatCurrency(plan.monthly)} / bulan`;
            document.getElementById('planProfile').textContent = appState.userProfile;
            
            const feedbackEl = document.getElementById('capacityFeedback');
            const capacity = appState.financialProfile.capacity;
            if (plan.monthly <= capacity) {
                feedbackEl.className = 'mb-6 p-3 rounded-lg text-sm text-center bg-green-100 text-green-800';
                feedbackEl.innerHTML = `<i data-lucide="check-circle" class="inline-block w-4 h-4 mr-1"></i> Rencana ini <strong>sesuai</strong> dengan kemampuan investasimu.`;
            } else {
                feedbackEl.className = 'mb-6 p-3 rounded-lg text-sm text-center bg-yellow-100 text-yellow-800';
                feedbackEl.innerHTML = `<i data-lucide="alert-triangle" class="inline-block w-4 h-4 mr-1"></i> Setoran ini <strong>di atas</strong> kemampuan investasimu. Pastikan keuanganmu tetap sehat.`;
            }

            renderPortfolioChart(plan.portfolio);
            renderProjectionChart();

            const slider = document.getElementById('simulationSlider');
            slider.value = plan.monthly;
            slider.min = Math.max(100000, plan.monthly / 2);
            slider.max = Math.min(50000000, plan.monthly * 3);
            const updateSim = () => {
                const monthly = parseInt(slider.value);
                document.getElementById('simulationValue').textContent = formatCurrency(monthly);
                const { target, years } = appState.activePlan;
                const r = ({ 'Konservatif': 0.05, 'Moderat': 0.08, 'Agresif': 0.12 }[appState.userProfile] || 0.08) / 12;
                const n = Math.log((target * r / monthly) + 1) / Math.log(1 + r);
                const yearsSaved = years - (n / 12);
                document.getElementById('simulationResult').textContent = yearsSaved > 0.1 ? `Tujuan tercapai ${yearsSaved.toFixed(1)} tahun lebih cepat!` : `Ayo tingkatkan setoranmu!`;
            };
            slider.oninput = updateSim;
            updateSim();
            lucide.createIcons();
        }
        
        function renderPortfolioChart(portfolioData) { /* Same logic */
            const ctx = document.getElementById('portfolioChart').getContext('2d');
            const labels = Object.keys(portfolioData), data = Object.values(portfolioData);
            const colors = ['#f97316', '#3b82f6', '#16a34a', '#ef4444'];
            if (portfolioChartInstance) portfolioChartInstance.destroy();
            portfolioChartInstance = new Chart(ctx, { type: 'doughnut', data: { labels, datasets: [{ data, backgroundColor: colors, borderColor: '#fff', borderWidth: 4 }] }, options: { responsive: true, cutout: '70%', plugins: { legend: { display: false }, tooltip: { callbacks: { label: c => `${c.label}: ${c.raw}%` } } } } });
            const legendContainer = document.getElementById('portfolioLegend');
            legendContainer.innerHTML = '';
            labels.forEach((label, i) => {
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between text-sm';
                item.innerHTML = `<div class="flex items-center"><span class="w-3 h-3 rounded-full mr-2" style="background-color: ${colors[i]}"></span><span>${label}</span></div><span class="font-bold">${data[i]}%</span>`;
                legendContainer.appendChild(item);
            });
        }
        
        function renderProjectionChart() { /* Same logic */
            const { years, monthly } = appState.activePlan;
            const baseRate = { 'Konservatif': 0.05, 'Moderat': 0.08, 'Agresif': 0.12 }[appState.userProfile] || 0.08;
            const project = rate => { let bal=0, bals=[0]; for(let y=0;y<years;y++){ bal=(bal+(monthly*12))*(1+rate); bals.push(bal); } return bals; };
            const labels = Array.from({ length: years + 1 }, (_, i) => `T${i}`);
            const datasets = [ { label: 'Pesimis', data: project(baseRate - 0.03), borderColor: '#ef4444', fill: false, tension: 0.1 }, { label: 'Normal', data: project(baseRate), borderColor: '#3b82f6', fill: false, tension: 0.1, borderWidth: 3 }, { label: 'Optimis', data: project(baseRate + 0.03), borderColor: '#16a34a', fill: false, tension: 0.1 } ];
            const ctx = document.getElementById('projectionChart').getContext('2d');
            if (projectionChartInstance) projectionChartInstance.destroy();
            projectionChartInstance = new Chart(ctx, { type: 'line', data: { labels, datasets }, options: { responsive: true, scales: { y: { ticks: { callback: v => formatCurrency(v).replace(/\,00$/, '') } } }, plugins: { tooltip: { callbacks: { label: c => `${c.dataset.label}: ${formatCurrency(c.raw)}` } } } } });
        }
        
        function updateDashboard() {
            if (!appState.userProfile || !appState.financialProfile) return;
            document.getElementById('userProfile').textContent = appState.userProfile;
            document.getElementById('investmentCapacity').textContent = `${formatCurrency(appState.financialProfile.capacity).replace(',00','')}/bln`;
            document.getElementById('notificationBadge').style.display = appState.roadmap.monthlyDepositDue ? 'block' : 'none';

            const goalsContainer = document.getElementById('goalsContainer');
            goalsContainer.innerHTML = '';
            let totalAssets = appState.goals.reduce((sum, goal) => sum + goal.current, 0);

            appState.goals.forEach(goal => {
                const progress = goal.target > 0 ? (goal.current / goal.target) * 100 : 0;
                const goalCard = document.createElement('div');
                goalCard.className = 'bg-white border rounded-lg p-4 shadow-sm flex items-center space-x-4';
                goalCard.innerHTML = `<div class="w-12 h-12 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center flex-shrink-0"><i data-lucide="${goal.icon || 'target'}"></i></div><div class="flex-grow"><div class="flex justify-between items-start"><div><p class="font-bold capitalize">${goal.name}</p><p class="text-sm text-gray-500">Target: ${formatCurrency(goal.target)}</p></div>${getTerm(goal.years)}</div><div class="mt-2"><div class="flex justify-between text-xs mb-1"><span class="font-semibold text-blue-700">${formatCurrency(goal.current)}</span><span class="text-gray-500">${progress.toFixed(1)}%</span></div><div class="w-full bg-gray-200 rounded-full h-2"><div class="bg-blue-600 h-2 rounded-full progress-bar-fill" style="width: ${progress}%"></div></div></div></div>`;
                goalsContainer.appendChild(goalCard);
            });
            document.getElementById('totalAssets').textContent = formatCurrency(totalAssets);
            
            const achievementsContainer = document.getElementById('achievementsContainer');
            document.getElementById('achievementsSection').style.display = appState.achievements.length > 0 ? 'block' : 'none';
            achievementsContainer.innerHTML = '';
            appState.achievements.forEach(ach => {
                const badge = document.createElement('div');
                badge.className = 'flex flex-col items-center text-center w-20 flex-shrink-0';
                badge.innerHTML = `<div class="w-16 h-16 bg-yellow-100 text-yellow-600 rounded-full flex items-center justify-center mb-1"><i data-lucide="${ach.icon}"></i></div><p class="text-xs font-semibold">${ach.name}</p>`;
                achievementsContainer.appendChild(badge);
            });
            lucide.createIcons();
        }

        function renderRoadmap() {
            const container = document.getElementById('roadmapContainer');
            container.innerHTML = '';
            if (appState.roadmap.monthlyDepositDue) {
                container.innerHTML = `<div class="bg-white border rounded-lg p-4 shadow-sm"><div class="flex items-center justify-between"><div class="flex items-center"><i data-lucide="calendar" class="w-6 h-6 mr-3 text-blue-500"></i><div><p class="font-bold">Setoran Rutin Bulan Ini</p><p class="text-sm text-gray-500">Ayo jaga konsistensimu!</p></div></div><button onclick="completeMonthlyDeposit()" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg">Selesaikan</button></div></div>`;
            } else {
                container.innerHTML = `<div class="bg-green-50 border border-green-200 text-green-800 rounded-lg p-4 text-center"><p class="font-semibold">Hebat! Semua aksimu untuk bulan ini sudah selesai.</p></div>`;
            }
            lucide.createIcons();
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            const templates = [ { name: 'Dana Darurat', icon: 'shield-alert' }, { name: 'DP Properti', icon: 'home' }, { name: 'Menikah', icon: 'heart' }, { name: 'Kendaraan', icon: 'car' }, { name: 'Pendidikan Anak', icon: 'graduation-cap' }, { name: 'Dana Pensiun', icon: 'gem' }, { name: 'Liburan', icon: 'plane' }, { name: 'Barang Impian', icon: 'shopping-bag' }, { name: 'Lainnya', icon: 'plus-circle' } ];
            const container = document.getElementById('goalTemplatesContainer');
            templates.forEach(t => {
                const el = document.createElement('div');
                el.className = 'flex flex-col items-center justify-center p-4 border rounded-lg hover:bg-blue-50 cursor-pointer';
                el.onclick = () => selectGoalTemplate(t.name, t.icon);
                el.innerHTML = `<i data-lucide="${t.icon}" class="w-8 h-8 mb-2 text-blue-600"></i><p class="text-sm font-semibold">${t.name}</p>`;
                container.appendChild(el);
            });
            lucide.createIcons();
        });
    </script>
</body>
</html>

